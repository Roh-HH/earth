<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="board">
	<!-- SQL문 정렬 순서 : CRUD순 1차 정렬 + 공용 및 게시판 번호순 2차 정렬 -->
	
	
	<!-- Create(insert) -->
	<insert id="insertNotice" parameterType="noticeDTO">
		insert into notice values(notice_seq.nextval, #{subject}, #{id}, #{pw}, #{ctt}, #{img}, sysdate, #{readcount}, #{code})
	</insert>
	
	<insert id="insertFree" parameterType="freeDTO">
		insert into free values(free_seq.nextval, #{subject}, #{categ}, #{id}, #{pw}, #{ctt}, #{img}, sysdate, #{readcount}, #{code})
	</insert>
	<insert id="uploadFreeComment" parameterType="freecommentDTO">
		insert into freecomment values(freecom_seq.nextval, #{freenum}, #{ref}, #{relevel}, sysdate, #{receiver}, #{writer}, #{ctt})
	</insert>
	
	<insert id="insertChallenge" parameterType="monthDTO">
		insert into challenge values(challenge_seq.nextval, #{subject}, #{id}, #{pw}, #{ctt}, #{img}, sysdate, 0, #{maxcount}, 4, #{actable})
	</insert>
	
	<insert id="upload" parameterType="todayDTO">
		insert into today values(today_seq.nextval, #{id}, #{ctt}, sysdate, #{code}, #{condition}) 
	</insert>
	
	
	<!-- Read(select) -->
	<select id="countAllNotice" resultType="int">
		select count(*) from notice
	</select>
	<select id="getPwNotice" resultType="string">
		select pw from notice where boardnum = #{value}
	</select>
	<select id="getNoticeArticles" parameterType="hashmap" resultType="noticeDTO">		
		<![CDATA[
			select B.* from (select A.*, rownum r from (select * from notice order by reg desc) A) B where r >= #{start} and r <= #{end}
		]]>
	</select>
	<select id="getNoticeArticle" parameterType="int" resultType="noticeDTO">
			select * from notice where boardnum = #{value}
	</select>
	
	<select id="countAllFree" resultType="int">
		select count(*) from free
	</select>
	<select id="getPwFree" resultType="string">
		select pw from free where boardnum = #{value}
	</select>
	<select id="getFreeArticles" parameterType="hashmap" resultType="freeDTO">		
		<![CDATA[
			select B.* from (select A.*, rownum r from (select * from free order by reg desc) A) B where r >= #{start} and r <= #{end}
		]]>
	</select>
	<select id="getFreeArticle" parameterType="int" resultType="freeDTO">
			select * from free where boardnum = #{value}
	</select>
	<select id="getBrackets" resultType="string">
		select name from brackets
	</select>
	<select id="getBracketsDTO" resultType="bracketsDTO">
		select * from brackets
	</select>
	<select id="getFreeComment" parameterType="int" resultType="freecommentDTO">
			select * from freecomment where freenum = #{value} order by ref
	</select>
	<select id="getRefFree" parameterType="int" resultType="string">
			select max(ref) from freecomment where freenum = #{value}
	</select>
	<select id="getRefCountFree" parameterType="int" resultType="string">
			select count(ref) from freecomment where freenum = #{value}
	</select>
	
	<select id="countAllDiary" resultType="int">
		select count(*) from diary
	</select>
	<select id="getPwDiary" resultType="string">
		select pw from diary where boardnum = #{value}
	</select>
	
	<select id="countAllChallenge" resultType="int">
		select count(*) from challenge
	</select>
	<select id="getPwChallenge" resultType="string">
		select pw from challenge where boardnum = #{value}
	</select>
	<select id="getChallengeArticles" parameterType="hashmap" resultType="monthDTO">
		<![CDATA[
			select B.* from (select A.*, rownum r from (select * from challenge order by reg desc) A) B where r >= #{start} and r <= #{end}
		]]>
	</select>
	<select id="getChallengeArticle" parameterType="int" resultType="monthDTO">
		select * from challenge where boardnum=${value}
	</select>
	
	<select id="countAllToday" resultType="int">
		select count(*) from today where to_char(reg,'YY/MM/DD') >= to_char(sysdate, 'YY/MM/DD')
	</select>
	<select id="getTodayArticles" parameterType="hashmap" resultType="todayDTO">		
		<![CDATA[
			select B.* from (select A.*, rownum r from (select * from today order by reg desc) A) B where r >= #{start} and r <= #{end} and to_char(reg,'YY/MM/DD') >= to_char(sysdate, 'YY/MM/DD')
		]]>
	</select>
	
	<select id="countAllShop" resultType="int">
		select count(*) from shop
	</select>
	<select id="getPwShop" resultType="string">
		select pw from shop where boardnum = #{value}
	</select>
	
	<select id="countAllEvent" resultType="int">
		select count(*) from event
	</select>
	<select id="getPwEvent" resultType="string">
		select pw from event where boardnum = #{value}
	</select>
	
	<select id="countAllTip" resultType="int">
		select count(*) from tip
	</select>
	
	<select id="getPwTip" resultType="string">
		select pw from tip where boardnum = #{value}
	</select>
	
	<select id="getCttNotice" resultType="string">
		select ctt from notice where boardnum = #{value}
	</select>
	
	
	<!-- Update -->
	<update id="addReadCountNotice" parameterType="int">
		<![CDATA[
			update notice set readcount=readcount+1 where boardnum = #{value}
		]]>
	</update>
	<update id="addReadCountFree" parameterType="int">
		<![CDATA[
			update free set readcount=readcount+1 where boardnum = #{value}
		]]>
	</update>
	<update id="subReadCountFree" parameterType="int">
		<![CDATA[
			update free set readcount=readcount-1 where boardnum = #{value}
		]]>
	</update>
	
	<update id="updateNoticeArticle" parameterType="noticeDTO">
		update notice set subject = #{subject}, ctt = #{ctt} where boardnum = #{boardnum}
	</update>
	<update id="updateNoticeArticleImg" parameterType="noticeDTO">
		update notice set subject = #{subject}, ctt = #{ctt}, img = #{img} where boardnum = #{boardnum}
	</update>
	
	<update id="updateFreeArticle" parameterType="freeDTO">
		update free set subject = #{subject}, ctt = #{ctt}, categ = #{categ} where boardnum = #{boardnum}
	</update>
	
	<update id="updateChallengeArticle" parameterType="monthDTO">
		update challenge set subject = #{subject}, ctt = #{ctt} where challengenum = #{challengenum}
	</update>
	
	<update id="updateChallengeArticleImg" parameterType="monthDTO">
		update challenge set subject = #{subject}, ctt = #{ctt}, img = #{img}, maxcount = #{maxcount} where challengenum = #{challengenum}
	</update>
	
	
	<!-- Delete -->
	<delete id="deleteArticleNotice" parameterType="int">
		delete from notice where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleFree" parameterType="int">
		delete from free where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleDiary" parameterType="int">
		delete from diary where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleChallenge" parameterType="int">
		delete from challenge where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleToday" parameterType="int">
		delete from today where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleShop" parameterType="int">
		delete from shop where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleEvent" parameterType="int">
		delete from event where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleTip" parameterType="int">
		delete from tip where boardnum = #{value}
	</delete>
	
	<delete id="deleteArticleFreeComment" parameterType="int">
		delete from freecomment where commentnum = #{value}
	</delete>
	
</mapper>
